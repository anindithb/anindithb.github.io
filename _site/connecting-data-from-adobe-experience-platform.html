<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Guidance for Connecting Data from Adobe Experience Platform to AWS Clean Rooms | AWS Solutions Library Samples</title><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/images/aws.png"><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/index.html" class="site-title lh-tight"> AWS Solutions Library Samples </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul style="padding-right: 10px;font-weight: 600;">Guidance for Connecting Data from Adobe Experience Platform to AWS Clean Rooms</ul><hr><ul class="nav-list"><li class="nav-list-item active"> <a href="#" class="nav-list-link">Get started</a><li class="nav-list-item active"> <a href="#scenario" class="nav-list-link">Scenario</a><li class="nav-list-item active"> <a href="#implementation-details" class="nav-list-link">Implementation Details</a><li class="nav-list-item active"> <a href="#data-ingestion" class="nav-list-link">Data Ingestion</a><li class="nav-list-item active"> <a href="#data-processing" class="nav-list-link">Data Processing</a><li class="nav-list-item active"> <a href="#data-catalog" class="nav-list-link">Data Catalog</a><li class="nav-list-item active"> <a href="#automation-using-aws-step-functions-and-amazon-eventbridge" class="nav-list-link">Automation using AWS Step Function and Amazon EventBridge</a><li class="nav-list-item active"> <a href="#1--create-aws-step-function" class="nav-list-link">Creating AWS Step Function</a><li class="nav-list-item active"> <a href="#2--schedule-the-aws-step-function-using-amazon-eventbridge-rule" class="nav-list-link">Scheduling AWS Step Function using Amazon Event Bridge</a><li class="nav-list-item active"> <a href="#closing-out" class="nav-list-link">Closing Out</a><li class="nav-list-item active"> <a href="#notices" class="nav-list-link">Notices</a></ul><ul class="nav-list"></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AWS Solutions Library Samples" aria-label="Search AWS Solutions Library Samples" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/just-the-docs/just-the-docs" class="site-button" > Just the Docs on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><div class="post-header"><h1 class="post-title-main"> Guidance for Connecting Data from Adobe Experience Platform to AWS Clean Rooms</h1></div><p class=".fs-6 .fw-300"> <b>Summary:</b> In this Guidance, you will ingest customer profile data from the Adobe Experience Platform (AEP) and ingest it into your Amazon Simple Storage Service (Amazon S3) bucket. The Guidance will demonstrate how to read this data, normalize it, and process it to make it compatible within AWS Clean Rooms.</p><hr /><h2 id="scenario"> <a href="#scenario" class="anchor-heading" aria-labelledby="scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scenario</h2><p>ACME is an AWS customer who uses the Adobe Experience Platform (AEP) to manage their customer profiles across all systems. The Chief Marketing Officer (CMO) of ACME wants to select a subset of the ACME customers contained in their AEP account and enrich this subset of users with additional data from a third-party. The CMO tasks the data engineering team to make this possible.</p><p>The ACME data engineering team evaluates this request and defines the following steps to do:</p><p><strong>Access and retrieval from AEP; data ingestion and security in AWS:</strong></p><ol><li><p>Create an Amazon Simple Storage Service (Amazon S3) repository that can receive the export object from AEP</p><li><p>Ensure the data is protected/secure and encrypted to adhere to the ACME security practices</p><li><p>Get access to the AEP account to select the specific fields needed (this provides schema stability downstream), and define and execute the query</p><li><p>Configure a periodic task that will execute this query and export the result set to the ACME AWS account</p></ol><p start="5"><strong>Transformation of data to target data structure/repository:</strong></p><ol start="5"><li>On receipt of this data into Amazon S3, they will need to initiate a process that will transform the data from the AEP format into the format required by the AWS Clean Rooms service identified for enabling the sharing and enrichment of the data set </ol><p start="6"><strong>Automation:</strong></p><ol start="6"><li>The data engineering team anticipates that they will do many similar tasks so they will automate this process for future re-use</ol><p>This Guidance aims to assist <em>ACME</em> to import their customer profile information in an ongoing manner (daily) from Adobe Experience Platform into their AWS account and thereafter, process it, normalize it, and prepare it for consumption within an AWS Clean Rooms environment using AWS native services.</p><h2 id="implementation-details"> <a href="#implementation-details" class="anchor-heading" aria-labelledby="implementation-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation Details</h2><p>In this Guidance, customer profile data from the Adobe Experience Platform (AEP) is ingested into your Amazon Simple Storage Service (Amazon S3) bucket. The Guidance will demonstrate how to read this data, normalize it, and process it to make it compatible within AWS Clean Rooms.</p><p><strong>Reference Architecture</strong></p><figure><img class="docimage" src="images/AEM/AEM_figure1.png" alt="" /></figure><p><em><strong>Figure 1:</strong> Reference Architecture for importing AEP data into AWS</em></p><h2 id="data-ingestion"> <a href="#data-ingestion" class="anchor-heading" aria-labelledby="data-ingestion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Ingestion</h2><p>In order to ingest data from AEP, you will need to setup a daily export schedule from within AEP to Amazon S3.</p><p>The dataset used in this Guidance is Adobe Experience Platform Customer Profile.</p><p><strong>Adobe Experience Platform (AEP) and Amazon S3 integration</strong></p><p>In this section, you will establish a live outbound connection to your Amazon S3 storage to periodically (daily) export customer profile data from AEP for a given selected segment.</p><p><strong><em>1. Create an Amazon S3 bucket for receiving data from AEP</em></strong></p><p>You will create an Amazon S3 bucket that will serve as the landing zone for the incoming data files from AEP.</p><ol><li><p>Sign in into AWS console and navigate to <strong>Amazon S3</strong> bucket page (https://console.aws.amazon.com/s3/buckets)</p><li><p>Choose <strong>Create bucket</strong></p><li><p>Provide a globally unique bucket name</p><li><p>Choose the appropriate region</p><li><p>Block public access</p><li><p>Enable Bucket Versioning</p><li><p>Enable SSE-S3 based bucket encryption</p><li><p>Provide appropriate tag(s)</p><li><p>Create bucket</p></ol><p>Once the bucket is created, create three folders within the bucket.</p><ol><li><p>Navigate within the bucket and click <strong>Create folder</strong></p><li><p>Provide the folder name as <strong>landing</strong> and select SSE-S3 as the server-side encryption option</p></ol><p>Repeat the above two steps to create two folders named <strong>raw</strong> and <strong>archive.</strong></p><figure><img class="docimage" src="images/AEM/AEM_figure2.jpg" alt="" /></figure><p><em><strong>Figure 2:</strong> Displays UI when creating the landing folder</em></p><figure><img class="docimage" src="images/AEM/AEM_figure3.jpg" alt="" /></figure><p><em><strong>Figure 3:</strong> UI after all 3 folders are created</em></p><p><strong><em>2. AWS Access Keys and permissions</em></strong></p><p>You will have to provide AEP with Access Keys (access key ID and secret key ID) to connect to your Amazon S3 storage.</p><p class="note">It is recommended for you to create a separate AWS Identity and Access Management (IAM) user within your AWS account that has limited access to allow AEP to connect to Amazon S3 [see the next section for permissions required]. While AWS does not recommend sharing of access keys with any third party, AEP currently supports connectivity via access keys and therefore a separate dedicated service user will limit the exposure of your account.</p><p><strong>Steps to create an IAM user and generate access keys</strong></p><ol><li><p>Sign in into AWS console as a user with appropriate permissions to create IAM user and access keys</p><li><p>Navigate to the <a href="https://console.aws.amazon.com/iam/" target="_blank">AWS IAM</a> console</p><li><p>In the navigation pane, select <strong>Users</strong> → <strong>Add user</strong></p><li><p>Type the name of the user</p><li><p>Select <strong>Programmatic access</strong> to generate the access keys for this user that can be entered into AEP console</p><li><p>Within Permissions section, select <strong>Attach existing policies</strong> and click on <strong>Create Policy</strong></p><li><p>Within the new tab, create the policy as shown below </p><li><p>Navigate to the create user screen and refresh the policy list and select the policy created</p><li><p>Proceed to create the user</p><li><p><strong>Important</strong>: Download and save the CSV file with the access key details</p></ol><p class="highlight">Reference Link: <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console" target="_blank">https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console</a></p><p><strong>Setup IAM Permissions for the user in AWS for AEP to connect</strong> </p><p>For AEP to establish a connection and write data into Amazon S3, it needs the following permissions:</p><ul><li><p>s3:GetObject</p><li><p>s3:GetBucketLocation</p><li><p>s3:DeleteObject</p><li><p>s3:ListBucket</p><li><p>s3:PutObject</p><li><p>s3:ListMultipartUploadParts</p></ul><p>Below is the policy JSON to associate with the IAM user (please note to enter the correct S3 bucket ARN)</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:PutObject"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:GetBucketLocation"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:ListMultipartUploadParts"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:s3:::&lt;bucket-name&gt;/*"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:s3:::&lt;bucket-name&gt;"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><strong><em>3. Setup AWS Key Management Service (AWS KMS) based key for encryption-decryption</em></strong></p><p>You will create an AWS KMS key to generate a public-private key pair. This allows AEP to use the public key to encrypt the files while exporting them to Amazon S3. Later during the data processing, the private key will be used to decrypt the file for further processing.</p><ol><li><p>Sign into the AWS console and navigate to the <a href="https://console.aws.amazon.com/kms/home" target="_blank">AWS KMS</a> page.</p><li><p>Select <strong>Create a key</strong></p><li><p>Select <strong>Asymmetric</strong> as key type; <strong>Encrypt and Decrypt</strong> as key usage; <strong>RSA_2048</strong> as key spec</p><li><p>Provide the key alias name</p><li><p>Select the appropriate key administrators</p><li><p>Select the appropriate IAM roles and users (including the IAM user created above) to allow key usage. Note: also make sure to select the IAM role that will be responsible for decryption of the files later during the data processing stage</p><li><p>Create the key</p></ol><p>Once the key has been created, navigate to the key and select the <strong>Public Key</strong> tab and download the key. You will need this key for later while setting up the Amazon S3 connection within AEP.</p><figure><img class="docimage" src="images/AEM/AEM_figure4.jpg" alt="" /></figure><p><em><strong>Figure 4:</strong> Highlights Public Key tab</em></p><p><strong><em>4. Connect to Amazon S3 as a destination within AEP</em></strong></p><p class="note">You will need <strong>Manage Destinations</strong> access control permission as part of your AEP user permissions.</p><ol><li><p>Navigate to <strong>Connections</strong> → <strong>Destinations</strong> → <strong>Catalog</strong> and search for <strong>Amazon S3</strong></p><li><p>Select <strong>Set up</strong> if you do not have an active S3 connection already created. Alternatively, if you see <strong>Activate</strong> as an option, you can click on it and choose <strong>Configure new destination</strong> in the next screen that opens up.</p></ol><figure><img class="docimage" src="images/AEM/AEM_figure5.jpg" alt="" /></figure><p><em><strong>Figure 5:</strong> Highlights Amazon S3 with the <strong>Activate</strong> option</em></p><ol style="counter-reset:none"><li><p>Enter the access keys of the IAM user previously created</p><li><p>Enter the public key downloaded from AWS KMS in the previous section</p><li><p>Fill in additional details:</p><ul><li><p>name</p><li><p>description</p><li><p>bucket [the name of the bucket previously created]</p><li><p>folder path: <strong>landing/</strong></p></ul></ol><ol style="counter-reset:none"><li><p>Check the options for all the alerts</p><li><p>Save the destination configuration</p></ol><figure><img class="docimage" src="images/AEM/AEM_figure6.jpg" alt="" /></figure><p><em><strong>Figure 6:</strong> Highlights the options for different alerts</em></p><p class="highlight">Reference Link: <a href="https://experienceleague.adobe.com/docs/experience-platform/destinations/catalog/cloud-storage/amazon-s3.html?lang=en" target="_blank">https://experienceleague.adobe.com/docs/experience-platform/destinations/catalog/cloud-storage/amazon-s3.html?lang=en</a></p><p><strong><em>5. Create a batch export job within AEP to upload data files to Amazon S3</em></strong></p><p>You will setup an activation of audience data (batch profile export) to Amazon S3 in this section. </p><ol><li><p>Navigate to <strong>Connections</strong> → <strong>Destinations</strong> → <strong>Catalog</strong> and search for <strong>Amazon S3</strong></p><li><p>Select <strong>Activate Segments</strong></p><li><p>Choose the correct Amazon S3 connection and proceed</p><li><p>Select the desired segment of choice and proceed to scheduling. For this Guidance, select one segment from the list.</p><li><p>Create a schedule with the following options:</p><ul><li><p>export full files</p><li><p>schedule frequency: daily</p><li><p>select the time as 12pm GMT</p><li><p>save the schedule</p></ul></ol><figure><img class="docimage" src="images/AEM/AEM_figure7.jpg" alt="" /></figure><p><em><strong>Figure 7:</strong> Displays UI for creating a schedule</em></p><ol style="counter-reset:none"><li>Select the profile attributes</ol><p>Select <strong>add new fields</strong> and choose the below listed schema fields from the profile class:</p><div class="table-wrapper"><table><thead><tr><th><strong>Label</strong><th><strong>Adobe XDM Field Name</strong><tbody><tr><td>customerID<td>personID<tr><td>first_name<td>person.name.firstName<tr><td>last_name<td>person.name.lastName<tr><td>address_1<td>homeAddress.street1<tr><td>address_2<td>homeAddress.street2<tr><td>city<td>homeAddress.city<tr><td>state<td>homeAddress.stateProvince<tr><td>zip<td>homeAddress.postalCode<tr><td>country<td>homeAddress.country<tr><td>email<td>personalEmail.address<tr><td>phone<td>mobilePhone.number<tr><td>loyalty_member_status<td>loyalty.status<tr><td>segmentation_status<td>segmentMembership.status</table></div><ol style="counter-reset:none"><li>Review and finish the activation flow</ol><p class="highlight"><strong>Reference Link</strong>: <a href="https://experienceleague.adobe.com/docs/experience-platform/destinations/ui/activate/activate-batch-profile-destinations.html?lang=en#select-attributes" target="_blank">https://experienceleague.adobe.com/docs/experience-platform/destinations/ui/activate/activate-batch-profile-destinations.html?lang=en#select-attributes</a></p><p>Once the export is setup, AEP will publish one or more CSV files in Amazon S3 for the selected segment. The number of file(s) uploaded in Amazon S3 will depend on the amount of data that qualifies for that segment; for every five million profile records, one file is generated for the segment.</p><h2 id="data-processing"> <a href="#data-processing" class="anchor-heading" aria-labelledby="data-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Processing</h2><p>Once the data arrives from AEP in your Amazon S3 bucket, a daily prompt will decrypt the file(s), normalize it, perform the Personal Identifiable Information (PII) handling of the data and prepare it to be made available for AWS Clean Rooms.</p><p><strong><em>1. AWS Lambda function to decrypt the data file(s)</em></strong></p><p>An AWS Lambda function is used to decrypt the file(s) using the AWS KMS APIs and write the decrypted file(s) to a separate prefix/folder within the same Amazon S3 bucket.</p><p class="note">AWS Lambda IAM role will need appropriate permissions to read/write from Amazon S3 and AWS KMS</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"s3:ListBucket"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:s3:::[bucket name]"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:s3:::[bucket name]/*"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kms:Decrypt"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:kms:us-east-1:[accountid]:key/[KMS key id]"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><figure><img class="docimage" src="images/AEM/AEM_figure8.jpg" alt="" /></figure><p><em><strong>Figure 8:</strong> AWS Lambda function is used to decrypt files</em></p><p><strong>Sample code:</strong></p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">decrypt_data_key</span><span class="p">(</span><span class="n">data_key_encrypted</span><span class="p">):</span>
<span class="err">  </span> <span class="err"> </span><span class="s">"""Decrypt an encrypted data key

    :param data_key_encrypted: Encrypted ciphertext data key.
    :return Plaintext base64-encoded binary data key as binary string
    :return None if error
    """</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Decrypt the data key
</span><span class="err">  </span> <span class="err"> </span><span class="n">kms_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="s">'kms'</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">try</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">response</span> <span class="o">=</span>
<span class="n">kms_client</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">CiphertextBlob</span><span class="o">=</span><span class="n">data_key_encrypted</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">return</span> <span class="bp">None</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Return plaintext base64-encoded binary data key
</span><span class="err">  </span> <span class="err"> </span><span class="k">return</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">((</span><span class="n">response</span><span class="p">[</span><span class="s">'Plaintext'</span><span class="p">]))</span>
<span class="err">  </span> <span class="err"> </span>
<span class="err"> </span><span class="k">def</span> <span class="nf">decrypt_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="err">  </span> <span class="err"> </span><span class="s">"""Decrypt a file encrypted by encrypt_file()

    The encrypted file is read from &lt;filename&gt;.encrypted
    The decrypted file is written to &lt;filename&gt;.decrypted

    :param filename: File to decrypt
    :return: True if file was decrypted. Otherwise, False.
    """</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Read the encrypted file into memory
</span><span class="err">  </span> <span class="err"> </span><span class="k">try</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">'.encrypted'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">file_contents</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
<span class="err">  </span> <span class="err"> </span><span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">return</span> <span class="bp">False</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># The first NUM_BYTES_FOR_LEN bytes contain the integer length of the
</span><span class="err">  </span> <span class="err"> </span><span class="c1"># encrypted data key.
</span><span class="err">  </span> <span class="err"> </span><span class="c1"># Add NUM_BYTES_FOR_LEN to get index of end of encrypted data key/start
</span><span class="err">  </span> <span class="err"> </span><span class="c1"># of encrypted data.
</span><span class="err">  </span> <span class="err"> </span><span class="n">data_key_encrypted_len</span> <span class="o">=</span>
<span class="nb">int</span><span class="p">.</span><span class="nf">from_bytes</span><span class="p">(</span><span class="n">file_contents</span><span class="p">[:</span><span class="n">NUM_BYTES_FOR_LEN</span><span class="p">],</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">byteorder</span><span class="o">=</span><span class="s">'big'</span> \<span class="p">)</span> 
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">+</span> <span class="n">NUM_BYTES_FOR_LEN</span>
<span class="err">  </span> <span class="err"> </span><span class="n">data_key_encrypted</span> <span class="o">=</span>
<span class="n">file_contents</span><span class="p">[</span><span class="n">NUM_BYTES_FOR_LEN</span><span class="p">:</span><span class="n">data_key_encrypted_len</span><span class="p">]</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Decrypt the data key before using it
</span><span class="err">  </span> <span class="err"> </span><span class="n">data_key_plaintext</span> <span class="o">=</span> <span class="nf">decrypt_data_key</span><span class="p">(</span><span class="n">data_key_encrypted</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">if</span> <span class="n">data_key_plaintext</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">return</span> <span class="bp">False</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Decrypt the rest of the file
</span><span class="err">  </span> <span class="err"> </span><span class="n">f</span> <span class="o">=</span> <span class="nc">Fernet</span><span class="p">(</span><span class="n">data_key_plaintext</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">file_contents_decrypted</span> <span class="o">=</span>
<span class="n">f</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">file_contents</span><span class="p">[</span><span class="n">data_key_encrypted_len</span><span class="p">:])</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># Write the decrypted file contents
</span><span class="err">  </span> <span class="err"> </span><span class="k">try</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">'.decrypted'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_decrypted</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">file_decrypted</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">file_contents_decrypted</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">return</span> <span class="bp">False</span>

<span class="err">  </span> <span class="err"> </span><span class="c1"># The same security issue described at the end of encrypt_file()
</span><span class="n">exists</span>
<span class="err">  </span> <span class="err"> </span><span class="c1"># here, too, i.e., the wish to wipe the data_key_plaintext value
</span><span class="k">from</span>
<span class="err">  </span> <span class="err"> </span><span class="c1"># memory.
</span><span class="err">  </span> <span class="err"> </span><span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div><p><strong><em>2. Data Exploration using AWS Glue DataBrew</em></strong></p><p>In this Guidance, you will use AWS Glue DataBrew to explore the incoming data and create the recipe to normalize and process the data.</p><p class="note">While other AWS services can be used to perform these tasks, AWS Glue DataBrew is chosen to demonstrate the ease of manipulating the data visually using the AWS Glue DataBrew service.</p><ol><li><p>Sign in into the AWS console as a user with the appropriate permissions to create IAM user and access keys</p><li><p>Navigate to <a href="https://console.aws.amazon.com/databrew/" target="_blank">AWS Glue DataBrew</a></p><li><p>Select <strong>Create project</strong></p><li><p>Provide the name of the project</p><li><p>Select <strong>Create new recipe</strong> and provide a name</p><li><p>Choose <strong>New dataset</strong> and select <strong>Amazon S3</strong> as your source</p><li><p>Provide the path as follows: s3://[bucket name]/raw/&lt;.*&gt;.csv</p></ol><p>This will ensure that all file(s) in the landing/ folder will be picked up for processing</p><figure><img class="docimage" src="images/AEM/AEM_figure9.jpg" alt="" /></figure><p><em><strong>Figure 9:</strong> AWS Glue DataBrew UI with <strong>New dataset</strong> highlighted</em></p><ol style="counter-reset:none"><li><p>Select CSV as the file type and treat first row as header options</p><li><p>Provide the appropriate tags; this will help for cost calculation/monitoring</p><li><p>Choose the appropriate IAM role (or create one if it does not exist)</p><ul><li><p>Your IAM user needs permission to access the AWS <a href="https://docs.aws.amazon.com/databrew/latest/dg/setting-up-iam-policy-for-databrew-console-access.html" target="_blank">Glue DataBrew from AWS Console</a></p><li><p><a href="https://docs.aws.amazon.com/databrew/latest/dg/setting-up-iam-policy-for-data-resources-role.html" target="_blank">IAM permissions</a> for AWS Glue DataBrew to access the data resources on your behalf</p></ul><li><p>Create project</p></ol><p>Once the project has been created, a visual editor displaying a sample of 500 records will open up.</p><p>At this stage, you can add steps for data cleansing, normalization, and PII handling.</p><figure><img class="docimage" src="images/AEM/AEM_figure10.jpg" alt="" /></figure><p><em><strong>Figure 10:</strong> Visual editor displaying a sample of records</em></p><p>The following steps will be performed as part of data processing:</p><p><strong>1. Normalization</strong> - the incoming data will be parsed and the column names will be appropriately renamed. While this is an optional step, mapping the schema makes this dataset further accessible within AWS Clean Rooms for additional workflows such as identity resolution and de-duplication.</p><p>Certain columns are cleansed (for example, phone number formatting is performed), data quality checks are performed to drop records that do not match the criteria, for example, drop records with empty email values.</p><p><strong>2. PII Data Handling</strong> - the PII information in the incoming data is hashed using a secret key from AWS Secrets Manager.</p><p class="highlight"><strong>Reference Link</strong>: <a href="https://docs.aws.amazon.com/databrew/latest/dg/recipe-actions.CRYPTOGRAPHIC_HASH.html" target="_blank">https://docs.aws.amazon.com/databrew/latest/dg/recipe-actions.CRYPTOGRAPHIC_HASH.html</a></p><p>Once all the steps have been completed, publish the recipe. This will create a version of the recipe.</p><figure><img class="docimage" src="images/AEM/AEM_figure11.jpg" alt="" /></figure><p><strong>Figure 11:</strong> Data processing step with <strong>Publish</strong> and <strong>Create job</strong> highlighted</p><p>Select <strong>Create Job</strong> to run the above recipe on the entire dataset and generate an output.</p><ol><li><p>Provide the job name</p><li><p>Under the <strong>Job output settings</strong> create Output 1 as follows:</p><ul><li><p>Amazon S3 | Parquet file format | Snappy compression [if you do not have an Amazon S3 output location, you can create one by following the steps outlined in the section <em>Create an Amazon S3 bucket</em>]</p><li><p>Provide the Amazon S3 output location</p><li><p>Click on the settings for Output 1</p><ul><li>Replace output files for each job run (this option is chosen since this is a full refresh)</ul></ul></ol><figure><img class="docimage" src="images/AEM/AEM_figure12.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure13.jpg" alt="" /></figure><p><em><strong>Figures 12 and 13:</strong> Job output settings</em></p><ul><li><p>Provide the appropriate tags</p><li><p>Chose the IAM role that was previously created/chosen while creating the AWS Glue DataBrew project</p><li><p>this role needs permissions to access the source Amazon S3 data and write to Amazon S3 at the output location</p><ul><li>Create and run job</ul></ul><p>Navigate to the JOBS section in the left menu and wait until the job you just created runs successfully.</p><figure><img class="docimage" src="images/AEM/AEM_figure14.jpg" alt="" /></figure><p><strong>*Figure 14:</strong> JOBS section in AWS Glue DataBrew UI</p><p>Once the job is successfully completed, navigate to the output Amazon S3 location to verify.</p><p>As you observe in the below screenshot, two output files have been generated, one for each input source file.</p><figure><img class="docimage" src="images/AEM/AEM_figure15.jpg" alt="" /></figure><p><em><strong>Figure 15:</strong> Two output files are generated</em></p><p><strong>3. AWS Lambda function for cleanup</strong></p><p>An AWS Lambda function is used to perform cleanup activities, namely moving the file(s) from landing/ and raw/ prefix to an archive/ prefix folder within the same Amazon S3 bucket.</p><blockquote><p><strong>Note</strong>: AWS Lambda IAM role will need appropriate permissions to read/write from Amazon S3</p></blockquote><figure><img class="docimage" src="images/AEM/AEM_figure16.jpg" alt="" /></figure><p><em><strong>Figure 16:</strong> Diagram of Lambda function</em></p><h2 id="data-catalog"> <a href="#data-catalog" class="anchor-heading" aria-labelledby="data-catalog"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Catalog</h2><p>In order to use the AEP data in AWS Clean Rooms environment, the data needs to be registered with AWS Glue Data Catalog as a table.</p><p><strong><em>1. Create AWS Glue Data Catalog database</em></strong></p><p>You will create a database within AWS Glue Data Catalog</p><ol><li><p>Sign in into AWS console and navigate to the <a href="https://console.aws.amazon.com/glue" target="_blank">AWS Glue Data Catalog</a> page</p><li><p>Select <strong>Databases</strong> under the <strong>Data catalog</strong> section in the left menu</p><li><p>Select <strong>Add database</strong> and provide a name</p></ol><p start="2"><strong><em>2. Create AWS Glue Crawler</em></strong></p><p>You can use a crawler to populate the AWS Glue Data Catalog with tables by crawling the Amazon S3 bucket output location. Upon completion, the crawler creates the table in your data catalog. This table can be later referenced within AWS Clean Rooms environment.</p><ol><li><p>Sign in into AWS console and navigate to <a href="https://console.aws.amazon.com/glue" target="_blank">AWS Glue Data Catalog</a> page</p><li><p>Select <strong>Crawlers</strong> under the Data catalog section in the left menu</p><li><p>Select <strong>Add crawler</strong> option</p><li><p>Provide the name for the crawler and appropriate tags</p><li><p>Under security configuration, choose the security configuration as recommended by your admin. If there is no existing security configuration, you can create one by selecting the <strong>Security configurations</strong> from the left panel menu. The security configuration allows you to specify encryption options for the Amazon S3 bucket that the AWS Glue service will write to along with logging encryption options to Amazon CloudWatch.</p><li><p>Chose <strong>Data stores</strong> and <strong>Crawl all folders</strong> as the crawler source type options; since this Guidance is for a full refresh, crawl all folders will yield the desired result as older data will be overwritten with new data.</p><li><p>Add a data store</p><ul><li>Enter S3 and provide output bucket location:</ul></ol><figure><img class="docimage" src="images/AEM/AEM_figure17.jpg" alt="" /></figure><p><strong>*Figure 17:</strong> Adding a data store</p><ol style="counter-reset:none"><li>Choose an IAM Role or let AWS Glue create a role for you:</ol><figure><img class="docimage" src="images/AEM/AEM_figure18.jpg" alt="" /></figure><p><em><strong>Figure 18:</strong> Choose an IM role or let Aws Glue create an IAM role for you</em></p><ol style="counter-reset:none"><li>Choose Frequency as <strong>Run on demand</strong>. We will be automating the entire workflow using AWS Step Functions in the later section.</ol><ol style="counter-reset:none"><li>Choose the database previously created as the crawler’s output</ol><ol style="counter-reset:none"><li>Create a crawler and run it</ol><p>Once the crawler runs successfully, verify the AWS Glue Data Catalog table is created.</p><p>Navigate to the <strong>Tables</strong> section from the left panel menu.</p><figure><img class="docimage" src="images/AEM/AEM_figure19.jpg" alt="" /></figure><p><strong>Figure 19:</strong> AWS Glue Data Catalog</p><p><strong><em>3. Verification</em></strong></p><p>You can further verify that the table has been successfully created in AWS Glue Data Catalog by running a query in Amazon Athena.</p><ol><li><p>Navigate to <strong>Amazon Athena Query Editor</strong> in your AWS Console</p><li><p>Select <strong>AwsDataCatalog</strong> as the Data source</p><li><p>Select the <strong>AWS Glue Data Catalog</strong> database</p><li><p>Under the <strong>Query text</strong> area, you can run a SELECT query to verify the data displays</p></ol><figure><img class="docimage" src="images/AEM/AEM_figure20.jpg" alt="" /></figure><p><strong>Figure 20:</strong> Amazon Athena query</p><h2 id="automation-using-aws-step-functions-and-amazon-eventbridge"> <a href="#automation-using-aws-step-functions-and-amazon-eventbridge" class="anchor-heading" aria-labelledby="automation-using-aws-step-functions-and-amazon-eventbridge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Automation using AWS Step Functions and Amazon EventBridge</h2><p>To make the entire solution automated and deployable as a unit, you will use AWS Step Functions to integrate the data processing workflow. On a daily scheduled run, the AWS Step Function will orchestrate various stages to decrypt and process the data and then initiate an AWS Glue Crawler job. Once the AWS Glue crawler job is completed, it will send a notification to the Amazon Simple Notification Service (Amazon SNS) topic letting you know that the data is available for consumption in AWS Clean Rooms.</p><h2 id="1--create-aws-step-function"> <a href="#1--create-aws-step-function" class="anchor-heading" aria-labelledby="1--create-aws-step-function"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Create AWS Step Function</h2><ol><li><p>Navigate to <strong>Step Functions</strong> in your AWS Console</p><li><p>Select <strong>Create state machine</strong></p><li><p>Design your workflow visually and create a standard type state machine</p><li><p>In the visual editor, draw your state machine definition as shown below with the correct configuration.</p></ol><figure><img class="docimage" src="images/AEM/AEM_figure21.jpg" alt="" /></figure><p><strong><em>Figure 21:</em></strong> Visual editor configuration</p><ol style="counter-reset:none"><li><p>Provide appropriate tag names</p><li><p>Let the step function create a new IAM role or choose an existing appropriate IAM role. <strong>Permissions needed for Step Function to execute as desired.</strong></p></ol><p>Ability to publish to Amazon SNS topics - error topic and success topic:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sns:Publish"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:sns:us-east-1:[accountid]:aep-error-handling"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:sns:us-east-1:[accountid]:aep-notification-topic"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Ability to invoke Lambda functions:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lambda:InvokeFunction"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:lambda:us-east-1:[accountid]:function:AEP-DecryptFiles:*"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:lambda:us-east-1:[accountid]:function:aep-cleanup-activities:*"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor1"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lambda:InvokeFunction"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:lambda:us-east-1:[accountid]:function:AEP-DecryptFiles"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:lambda:us-east-1:[accountid]:function:aep-cleanup-activities"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Ability to start a Glue DataBrew job:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"databrew:startJobRun"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"databrew:listJobRuns"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"databrew:stopJobRun"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"arn:aws:databrew:us-east-1:[accountid]:job/aep-customer-profile-job"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Ability to start an AWS Glue Crawler and its associated APIs for status check:</p><div start="7" class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"glue:GetCrawler"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"glue:StartCrawler"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:glue:us-east-1:[accountid]:crawler/aep-customer-profile"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><ol start="7"><li><strong>Save</strong> the step function definition</ol><p><strong>Error Handling within the AWS Step Function</strong></p><p>Each step within the Step Function will have a “catch-ALL” mechanism to trap all errors and report them. For this Guidance, you are not setting up any retry logic.</p><p>Example of a catch-ALL for a given step:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"Glue DataBrew StartJobRun"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:states:::databrew:startJobRun.sync"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aep-customer-profile-job"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Catch"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"ErrorEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="s2">"States.ALL"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Error Handling Notfication"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Next"</span><span class="p">:</span><span class="w"> </span><span class="s2">"StartCrawler"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>In the above snippet, any error state will result in a notification being sent to the error handling Amazon SNS topic that will further inform all the subscribers.</p><p><strong>Details about the State Machine</strong></p><p><strong>1. AWS Lambda - Decrypt CSV files</strong></p><p>Provide the ARN of the lambda function created previously that is responsible for decrypting the incoming files and placing them in the <strong>raw/</strong> prefix location</p><p><strong>Error Handling</strong>: For this Guidance, you will catch ALL errors and send a notification to an Amazon SNS topic for notification. Additionally, these errors will also be captured and logged within AWS CloudWatch Log Groups</p><figure><img class="docimage" src="images/AEM/AEM_figure22.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure23.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure24.jpg" alt="" /></figure><p><em><strong>Figures 22-24:</strong> Decrypting CSV files</em></p><p><strong>2. AWS Glue DataBrew StartJobRun</strong></p><p>a. Provide the name of the DataBrew Job; you can find this from the AWS Console → DataBrew → Jobs</p><p>b. Select the <strong>Wait for task to complete</strong> checkbox; this will ensure that the step machine waits to move to the next step until the DataBrew job is completed successfully</p><p class="note"><strong>Error Handling</strong>: For this Guidance, you will catch ALL errors and send a notification to an Amazon SNS topic for notification. Additionally, these errors will be captured and logged within AWS CloudWatch Log Groups.</p><figure><img class="docimage" src="images/AEM/AEM_figure25.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure26.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure27.jpg" alt="" /></figure><p><em><strong>Figures 25-27:</strong> AWS Glue DataBrew StartJobRun</em></p><p><strong>3. WS Glue StartCrawler</strong></p><ol><li>Provide the name of the glue crawler previously created; you can find this from AWS Console → Glue → Crawlers</ol><p><strong>Error Handling</strong>: For this Guidance, you will catch ALL errors and send a notification to an Amazon SNS topic for notification. Additionally, these errors will also be captured and logged within AWS CloudWatch Log Groups</p><p class="note">we will NOT check the wait for callback option; this is to avoid writing custom callback function. Instead, we will rely on the native APIs of AWS Glue Crawler to poll for status within the Step Function</p><figure><img class="docimage" src="images/AEM/AEM_figure28.jpg" alt="" /></figure><figure><img class="docimage" src="images/AEM/AEM_figure29.jpg" alt="" /></figure><p><em><strong>Figures 28-29:</strong> AWS Glue StartCrawler</em></p><p><strong>4. AWS Glue GetCrawler</strong></p><p>It fetches the meta information about the particular AWS Glue crawler including its current state. If the current state is RUNNING OR STOPPING, it will wait for a configured amount of time and fetch the information once again. This will continue until the AWS Glue crawler status is READY.</p><p><strong>Error Handling</strong>: For this Guidance, you will catch ALL errors and send a notification to an Amazon SNS topic for notification. Additionally, these errors will also be captured and logged within AWS CloudWatch Log Groups</p><p><strong>Example of GetCrawler output json</strong></p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="nl">"Crawler"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Classifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"CrawlElapsedTime"</span><span class="p">:</span><span class="w"> </span><span class="mi">12421</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"CrawlerSecurityConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"CreationTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-08-19T21:47:41Z"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"DatabaseName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amt-db"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"LakeFormationConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"AccountId"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"UseLakeFormationCredentials"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"LastCrawl"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"LogGroup"</span><span class="p">:</span><span class="w">
</span><span class="s2">"/aws-glue/crawlers-role/service-role/AWSGlueServiceRole-aep-customer-profile-role-s3"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"LogStream"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aep-customer-profile"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"MessagePrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2ab03631-e730-42cb-9d4b-b4a5a7f8b385"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"StartTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-08-23T02:59:58Z"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCEEDED"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"LastUpdated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-08-19T21:47:41Z"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"LineageConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"CrawlerLineageSettings"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DISABLE"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aep-customer-profile"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"RecrawlPolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"RecrawlBehavior"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CRAWL_EVERYTHING"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Role"</span><span class="p">:</span><span class="w">
</span><span class="s2">"service-role/AWSGlueServiceRole-aep-customer-profile-role"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"SchemaChangePolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"DeleteBehavior"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEPRECATE_IN_DATABASE"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"UpdateBehavior"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UPDATE_IN_DATABASE"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"State"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RUNNING"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"TablePrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aep"</span><span class="p">,</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Targets"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"CatalogTargets"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"DeltaTargets"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"DynamoDBTargets"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"JdbcTargets"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"MongoDBTargets"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"S3Targets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">{</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Exclusions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="nl">"Path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3://adobe-output-bucket-2022"</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">}</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="p">]</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="p">},</span><span class="w">
</span><span class="err">  </span><span class="w"> </span><span class="err"> </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="err">  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><strong>5. Choice State</strong></p><p></p><figure><img class="docimage" src="images/AEM/AEM_figure30.jpg" alt="" /></figure><p><em><strong>Figure 30:</strong> Choice state</em></p><p><strong>6. Wait state</strong></p><p>If the GetCrawler status is RUNNING or STOPPING, the step functions waits for a configured time of 30 seconds, and checks the status once again. If the status of the crawler is in any other state, it moves to the next state function, otherwise it continues to wait and checks for the status again.</p><p><strong>7. AWS Lambda - Cleanup activities</strong></p><p>Provide the ARN of the Lambda function created previously that is responsible for performing cleanup activities.</p><p><strong>Error Handling</strong>: For this Guidance, you will catch ALL errors and send a notification to an Amazon SNS topic for notification. Additionally, these errors will also be captured and logged within AWS CloudWatch Log Groups</p><p><strong>8. Publish to Amazon SNS upon successful execution</strong></p><p>Select the appropriate topic in the configuration panel of the step function</p><h2 id="2--schedule-the-aws-step-function-using-amazon-eventbridge-rule"> <a href="#2--schedule-the-aws-step-function-using-amazon-eventbridge-rule" class="anchor-heading" aria-labelledby="2--schedule-the-aws-step-function-using-amazon-eventbridge-rule"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Schedule the AWS Step Function using Amazon EventBridge rule</h2><p>You will create a rule in the Amazon EventBridge to invoke the AWS Step Function to start on a daily schedule.</p><ol><li><p>Sign in into AWS console and navigate to the <strong>Amazon EventBridge</strong> page</p><li><p>Select <strong>Create rule</strong></p><li><p>Provide the rule name and select <strong>schedule</strong> as the rule type</p></ol><figure><img class="docimage" src="images/AEM/AEM_figure31.jpg" alt="" /></figure><p><strong><em>Figure 31:</em></strong> Amazon EventBridge schedule highlighted</p><ol style="counter-reset:none"><li><p>select schedule pattern as “<em>A fine-grained pattern</em>”</p><li><p>Provide the cron expression as 0 0 * * ? *</p></ol><p>This will run the job at midnight everyday (UTC time zone)</p><figure><img class="docimage" src="images/AEM/AEM_figure32.jpg" alt="" /></figure><p><strong><em>Figure 32:</em></strong> Defining AWS Step Function</p><ol style="counter-reset:none"><li>Select <strong>AWS Service</strong> and <strong>Step Functions state machine</strong> as the target and select the step function:</ol><figure><img class="docimage" src="images/AEM/AEM_figure33.jpg" alt="" /></figure><p><em><strong>Figure 33:</strong> Selecting AWS Service and Step Functions state machine</em></p><ol style="counter-reset:none"><li><p>Provide the appropriate tags</p><li><p>Create the rule</p></ol><p>The rule will invoke the AWS Step Function daily to perform the data preparation task on the incoming data from AEP.</p><h2 id="closing-out"> <a href="#closing-out" class="anchor-heading" aria-labelledby="closing-out"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Closing Out</h2><p>In this Guidance, the focus was for ACME data engineers to be able to setup an ongoing data export from the Adobe Experience Platform and prepare it to be made available for business team members to use it in AWS Clean Rooms. </p><p>The Guidance is based on a consistent input schema that does not change, with a full refresh of data (periodic overwrite) every time a new export is pushed.</p><p>Future versions of this Guidance will address handling schema changes and incremental arrival of data.</p><h2 id="notices"> <a href="#notices" class="anchor-heading" aria-labelledby="notices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Notices</h2><p>Adobe, the Adobe logo, Acrobat, the Adobe PDF logo, Adobe Premiere, Creative Cloud, InDesign, and Photoshop are either registered trademarks or trademarks of Adobe in the United States.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p></footer></div></div><div class="search-overlay"></div></div>
