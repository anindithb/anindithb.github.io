<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Guidance for Meter Data Analytics on AWS | AWS Solutions Library Samples</title><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/images/aws.png"><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/index.html" class="site-title lh-tight"> AWS Solutions Library Samples </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul style="padding-right: 10px;font-weight: 600;">Guidance for Meter Data Analytics on AWS</ul><hr><ul class="nav-list"><li class="nav-list-item active"> <a href="#" class="nav-list-link">Get started</a><li class="nav-list-item active"> <a href="#overview" class="nav-list-link">Overview</a><li class="nav-list-item active"> <a href="#costs-and-licenses" class="nav-list-link">Costs and licenses</a><li class="nav-list-item active"> <a href="#architecture" class="nav-list-link">Architecture</a><li class="nav-list-item active"> <a href="#deployment-options" class="nav-list-link">Deployment options</a><li class="nav-list-item active"> <a href="#deployment-steps---using-cfn" class="nav-list-link">Deployment Steps - Using CFN</a><li class="nav-list-item active"> <a href="#troubleshooting" class="nav-list-link">Troubleshooting</a><li class="nav-list-item active"> <a href="#customer-responsibility" class="nav-list-link">Customer responsibility</a><li class="nav-list-item active"> <a href="#feedback" class="nav-list-link">Feedback</a><li class="nav-list-item active"> <a href="#notices" class="nav-list-link">Notices</a></ul><ul class="nav-list"></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AWS Solutions Library Samples" aria-label="Search AWS Solutions Library Samples" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/just-the-docs/just-the-docs" class="site-button" > Just the Docs on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><div class="post-header"><h1 class="post-title-main"> Guidance for Meter Data Analytics on AWS</h1></div><p class=".fs-6 .fw-300"> <b>Summary:</b> This guide covers the information you need to deploy "Guidance for Meter Data Analytics on AWS" in your AWS environment.</p><hr /><p>Refer to the <a href="https://github.com/aws-solutions-library-samples/guidance-for-meter-data-analytics-on-aws" target="_blank">GitHub repository</a> to view source files, report bugs, submit feature ideas, and post feedback about this Implementation Guide. To comment on the documentation, refer to <a href="#feedback">Feedback</a>.</p><p>This implementation guide provides an overview of the "Guidance for Meter Data Analytics on AWS," its reference architecture and components, considerations for planning the deployment, and configuration steps for deploying to Amazon Web Services (AWS). This guide is intended for solution architects, business decision makers, DevOps engineers, data scientists, and cloud professionals who want to implement "Guidance for Meter Data Analytics on AWS" in their environment.</p><h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview</h2><p>This guide covers the information you need to deploy “Guidance for Meter Data Analytics on AWS” in your AWS environment.</p><h2 id="costs-and-licenses"> <a href="#costs-and-licenses" class="anchor-heading" aria-labelledby="costs-and-licenses"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Costs and licenses</h2><p>This implementation guide is offered to users at no cost. However, if you deploy “Guidance for Meter Data Analytics to AWS” in your environment, you will be billed for any AWS services or resources you use in the deployment.</p><h2 id="architecture"> <a href="#architecture" class="anchor-heading" aria-labelledby="architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture</h2><p>Deploying this Guidance with default parameters builds the Meter Data Analytics (MDA) environment in the AWS Cloud, as shown in Figure 1.</p><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure1.png" alt="" /></figure><p><em>Figure 1. Solution architecture for Meter Data Analytics on AWS.</em></p><p>This Guidance sets up the following services:</p><ul><li><p>Amazon Simple Storage Service (Amazon S3) buckets to store:</p><ul><li><p>Weather and topology data from external databases.</p><li><p>Raw meter data.</p><li><p>Partitioned data.</p><li><p>Processed data from the AWS Step Functions model training workflow.</p></ul><li><p>AWS Lambda functions to:</p><ul><li><p>Load and transform topology data from an external database.</p><li><p>Process late-arriving meter data.</p><li><p>Obtain API query results of partitioned business data and Amazon SageMaker inferences.</p></ul><li><p>An AWS Glue crawler to transform meter data from the meter data management (MDM) system and headend system (HES) system into partitioned data.</p><li><p>Amazon EventBridge to process and store late-arriving meter data in the correct partition.</p><li><p>AWS Glue Data Catalog for a central catalog of weather, topology, and meter data.</p><li><p>Amazon Athena to provide query results of partitioned data.</p><li><p>Two Step Functions workflows:</p><ul><li><p>Model training to build a machine learning (ML) model using partitioned business data.</p><li><p>Batch processing of partitioned business data from the Data Catalog and ML model data for use in forecasting.</p></ul><li><p>SageMaker to generate energy usage inferences using the ML model.</p><li><p>Amazon API Gateway to manage API queries.</p></ul><h2 id="deployment-options"> <a href="#deployment-options" class="anchor-heading" aria-labelledby="deployment-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deployment options</h2><p>This Guidance provides one deployment option:</p><ul><li>CloudFormation (CFN) template – This uses assets already deployed in public S3 buckets. To use the latest updates, you have to use the ‘Manual deployment’ process.</ul><p>          o Download the template from https://github.com/aws-solutions-library-samples/guidance-for-meter-data-analytics-on-aws/blob/main/templates/work-load.template.yaml</p><ul><li>Manual deployment – Build and deploy in your AWS account</ul><p>         o Steps to build and deploy are in https://github.com/aws-solutions-library-samples/guidance-for-meter-data-analytics-on-aws</p><p>This Guidance lets you configure instance types and MDA settings.</p><h3 id="predeployment-steps"> Predeployment steps</h3><h3 id="meter-data-generator-and-hes-simulator"> Meter data generator and HES simulator</h3><p>The input adapter regularly pulls data from the HES simulator and prepares the data for further processing. During deployment, you can choose to deploy the meter data generator and HES simulator stacks by choosing ENABLED for the MeterDataGenerator parameter. You also configure the number of meters and the interval between meter reads with the TotalDevices and GenerationInterval parameters, respectively. The default values for these parameters generate 10,000 reads every 15 minutes.</p><h2 id="deployment-steps---using-cfn"> <a href="#deployment-steps---using-cfn" class="anchor-heading" aria-labelledby="deployment-steps---using-cfn"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deployment steps - using CFN</h2><ol><li><p>Sign in to your AWS account, and download the CloudFormation template for this Guidance, as described under <a href="#deployment-options">Deployment options</a>.</p><li><p>Navigate to <strong>CloudFormations.</strong></p><li><p>Select <strong>Create stack</strong>.</p><li><p>Select <strong>Upload a template file</strong>.</p><li><p>Select <strong>Choose file</strong> and select the downloaded file.</p><li><p>On the <strong>Create stack</strong> page, choose <strong>Next</strong>.</p><li><p>On the <strong>Specify stack details</strong> page, change the stack name if needed. Review the parameters for the template. Provide values for the parameters that require input. For all other parameters, review the default settings and customize them as necessary. When you finish reviewing and customizing the parameters, choose <strong>Next</strong>.</p></ol><blockquote class="note"><p>Unless you’re customizing the Guidance templates or are instructed otherwise in this guide’s <strong>Predeployment</strong> section, don’t change the default settings for the following parameters: <code class="language-plaintext highlighter-rouge">QSS3BucketName</code>, <code class="language-plaintext highlighter-rouge">QSS3BucketRegion</code>, and <code class="language-plaintext highlighter-rouge">QSS3KeyPrefix</code>. Changing the values of these parameters will modify code references that point to the Amazon S3 bucket name and key prefix.</p></blockquote><ol style="counter-reset:none"><li><p>On the <strong>Configure stack options</strong> page, you can <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-resource-tags.html" target="_blank">specify tags</a> (key-value pairs) for resources in your stack and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-add-tags.html" target="_blank">set advanced options</a>. When you finish, choose <strong>Next</strong>.</p><li><p>On the <strong>Review</strong> page, review and confirm the template settings. Under <strong>Capabilities</strong>, select all of the check boxes to acknowledge that the template creates AWS Identity and Access Management (IAM) resources that might require the ability to automatically expand macros.</p><li><p>Choose <strong>Create stack</strong>. The stack takes about 30 minutes to deploy.</p><li><p>Monitor the stack’s status, and when the status is <strong>CREATE_COMPLETE</strong>, the MDA deployment is ready.</p><li><p>To view the created resources, choose the <strong>Outputs</strong> tab.</p></ol><h3 id="postdeployment-steps"> Postdeployment steps</h3><p><strong>Set up Amazon Managed Grafana dashboards</strong></p><p>This Guidance includes a set of Amazon Managed Grafana dashboards. These dashboards use Athena to query data stored in a data lake and depend on several of the optional datasets for full functionality.</p><blockquote class="note"><p>Amazon Managed Grafana supports Security Assertion Markup Language (SAML) and IAM Identity Center for authentication. If your organization does not have SAML or IAM Identity Center set up, consult your administrator.</p></blockquote><h3 id="create-a-grafana-workspace"> Create a Grafana workspace</h3><ol><li><p>In the <a href="https://console.aws.amazon.com/grafana" target="_blank">Amazon Managed Grafana</a>console, choose <strong>Create workspace</strong>.</p><li><p>Enter a <strong>Workspace Name</strong> (for example, mda_solution). If desired, enter an optional <strong>Workspace Description</strong>.</p><li><p>Choose <strong>Next</strong>.</p><li><p>On the <strong>Configure Settings</strong> page, for <strong>Authentication access</strong>, select <strong>Security Assertion Markup Language (SAML)</strong>.</p><li><p>For <strong>Permission type</strong>, choose <strong>Service managed</strong>.</p><li><p>Choose <strong>Next</strong>.</p><li><p>On the <strong>Service managed permission settings</strong> page, for <strong>IAM permission access settings</strong>, choose <strong>Current account</strong>.</p><li><p>For <strong>Data sources and notification channels</strong>, select <strong>Amazon Athena</strong>.</p><li><p>Choose <strong>Next</strong>.</p><li><p>Choose <strong>Create workspace</strong>.</p></ol><h3 id="selectcreate-sso-users-and-groups"> Select/Create SSO users and groups</h3><p>After creating a Grafana workspace, select the single sign-on (SSO) users and groups with whom you want to share access. For more information, refer to <a href="https://docs.aws.amazon.com/grafana/latest/userguide/AMG-manage-users-and-groups-AMG.html" target="_blank">Managing user and group access to Amazon Managed Grafana</a>.</p><p>If you don’t already have users and groups setup in IAM Identity Center, follow these steps to create a user to be used with Grafana:</p><ol><li><p>In a new tab or browser window, navigate to the <strong>IAM Identity Center</strong> in AWS Console.</p><li><p>Select <strong>Users</strong> in the left panel.</p><li><p>Select <strong>Add user</strong> button on the right panel.</p><li><p>Add a user you would like to use for testing, as shown in Figure 2 below.</p></ol><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure2.png" alt="" /></figure><p><em>Figure 2. Screenshot showing how to add a user for testing.</em></p><ol style="counter-reset:none"><li><p>Choose <strong>Next</strong> at the bottom of the screen.</p><li><p>Choose <strong>Next</strong> again in the group creation screen.</p><li><p>Choose <strong>Add user</strong> button to create the user.</p><li><p>Choose <strong>Copy</strong> to copy the URL and login details for later use.</p></ol><h3 id="assign-sso-user-to-access-grafana"> Assign SSO user to access Grafana</h3><p>To give an SSO user access to Grafana, follow these steps:</p><ol><li><p>In the Grafana tab, choose the workspace <strong>mda_solution</strong> that was created.</p><li><p>Confirm you are in the <strong>Authentication</strong> tab.</p><li><p>Choose <strong>Assign new user or group</strong> button.</p><li><p>Select the checkbox next to the user that was created in the IAM Identity Center.</p><li><p>Select the button <strong>Assign users and groups.</strong></p><li><p>Select the checkbox next to the user, and then select the <strong>Action</strong> dropdown.</p><li><p>Select <strong>Make admin.</strong></p></ol><p>To access the workspace, follow these steps:</p><ol><li><p>Navigate to the URL that was saved when the user was created in IAM Identity Center.</p><li><p>Log in using the saved username and password.</p><li><p>You will be prompted to update the password the first time you log in.</p><li><p>Select the Amazon Grafana panel to open Grafana, as shown in Figure 3.</p></ol><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure3.png" alt="" /></figure><p><em>Figure 3. Screenshot showing Grafana in the Amazon Grafana panel.</em></p><h3 id="set-up-amazon-athena-as-a-data-source-in-grafana"> Set up Amazon Athena as a data source in Grafana</h3><p>Follow these steps to confirm Amazon Athena is added as a data source in Amazon Managed Grafana:</p><ol><li><p>Select <strong>Configuration</strong> (cog icon), and then select <strong>Data sources</strong>.</p><li><p>Validate that you can see the data sources for Athena shown in Figure 4.</p></ol><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure4.png" alt="" /></figure><p><em>Figure 4. Screenshot showing data sources for Athena.</em></p><p>If you run into issues, refer to <a href="https://docs.aws.amazon.com/grafana/latest/userguide/AWS-Athena.html" target="_blank">Amazon Athena</a> and <a href="https://grafana.com/docs/grafana/latest/administration/data-source-management/" target="_blank">Data Source Management</a>.</p><h3 id="import-dashboards-into-amazon-managed-grafana"> Import dashboards into Amazon Managed Grafana</h3><p>Upload or paste the contents of dashboard JSON files from the <code class="language-plaintext highlighter-rouge">/scripts/assets/grafana</code> folder of the <a href="https://fwd.aws/z8dwV?" target="_blank">solution’s repository</a> to Amazon Managed Grafana.</p><p>Follow these steps to upload the dashboard JSON:</p><ol><li><p>Select the <strong>+</strong> icon, and then select <strong>Import</strong>.</p><li><p>Select <strong>Upload JSON file</strong> to upload each JSON file.</p></ol><p>For more information, refer to <a href="https://docs.aws.amazon.com/grafana/latest/userguide/dashboard-export-and-import.html#importing-a-dashboard" target="_blank">Importing a dashboard</a>.</p><p>Follow these steps to view the imported dashboards:</p><ol><li><p>Select the <strong>Dashboards</strong> icon, and then select <strong>Browse</strong>.</p><li><p>You should see all the imported dashboards. Select each dashboard to view.</p></ol><p>After importing, you may need to verify that the names of dashboard panel data sources match AWS Glue database names. If you receive errors, check panel data sources and variables in dashboard settings. For more information, refer to <a href="https://docs.aws.amazon.com/grafana/latest/userguide/add-a-panel-to-a-dashboard.html" target="_blank">Adding or editing a panel</a> and <a href="https://docs.aws.amazon.com/grafana/latest/userguide/dashboard-overview.html" target="_blank">Dashboards</a>.</p><h3 id="input-adapter"> Input adapter</h3><p>As shown in Figure 5, the Guidance’s input adapter loads meter reads from an external source (such as HES or FTP) and prepares them for processing.</p><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure5.png" alt="" /></figure><p><em>Figure 5. Input adapter</em></p><p>A Step Functions workflow orchestrates the generation and download of the meter-reads file as a compressed file from the external database to the inbound bucket. Another process extracts the file from the inbound bucket and stores it in the uncompressed folder. The inbound bucket stores the compressed and uncompressed files. The Guidance deletes uncompressed files to save on storage and costs.</p><p>After the file is extracted, the Guidance generates an event that invokes a Lambda function for further processing. The file-range-extractor Lambda function extracts range information from the uncompressed file based on the file size and number of chunks (configurable). A range is a group of lines that you want to process together. Extracted range information is sent to Amazon Simple Queue Service (Amazon SQS).</p><p>Each worker takes a range from the Amazon SQS queue and processes the respective meter reads (parse and transform) before sending each element to Amazon Kinesis. This process ensures that the content input file can be processed in parallel. The worker transforms the CSV line into JSON and creates a separate object for each reading type. The Amazon Kinesis data stream ingests the data into the staging area. This stream scales on demand.</p><h3 id="dataflows"> Dataflows</h3><p>You can set up connections to other data sources by configuring additional dataflows. As shown in Figure 6, a dataflow connects to the external database, loads data from it, and stores data in a purpose-built database that can be accessed from the Guidance’s central data catalog.</p><figure><img class="docimage" src="images/meter_data_analytics_images/MD_Figure6.png" alt="" /></figure><p><em>Figure 6. Dataflow</em></p><p>The Guidance comes with two sample dataflows: weather and topology. To add a new dataflow, create a data pipeline that loads data from the source, prepares the data, and stores results in an appropriate data store. Then, add the data store you’ve configured to the Guidance’s data catalog.</p><h3 id="data-partitioning"> Data partitioning</h3><p>The weather data is partitioned in the S3 bucket <code class="language-plaintext highlighter-rouge">s3://gen-disabled-aws-utility-met-integrateddatabucket-\*/weather/date=\&lt;year\&gt;-\&lt;month\&gt;-\&lt;day\&gt;/\&lt;data-file-in-parquet-format\&gt;</code></p><p>The topology data is stored in the S3 bucket <code class="language-plaintext highlighter-rouge">s3://gen-disabled-aws-utility-met-integrateddatabucket-\*/topology/</code></p><p>The curated data in the integration stage S3 bucket is partitioned by reading type, year, month, day, and hour, as follows:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s3://<span class="se">\*</span><span class="nt">-integrateddatabucket-</span><span class="se">\*</span>/readings/parquet/reading_type<span class="o">=</span><span class="se">\&lt;</span>reading_type_value<span class="se">\&gt;</span>/year<span class="o">=</span><span class="se">\&lt;</span>year<span class="se">\&gt;</span>/month<span class="o">=</span><span class="se">\&lt;</span>month<span class="se">\&gt;</span>/day<span class="o">=</span><span class="se">\&lt;</span>day<span class="se">\&gt;</span>/hour<span class="o">=</span><span class="se">\&lt;</span>hour<span class="se">\&gt;</span>/<span class="se">\&lt;</span>meter-data-file-in-parquet-format<span class="se">\&gt;</span>
</code></pre></div></div><p>You can find all meter reads for the hour of a day on the lowest level of the partition tree. To optimize query performance, the data is stored in a column-based file format (Parquet).</p><h3 id="late-arriving-data"> Late-arriving data</h3><p>The data lake handles late-arriving meter reads. Late-arriving meter reads are detected as soon as the data reaches the staging phase. If a late read is detected, an event is sent to Amazon EventBridge. The extract, transform, load (ETL) pipeline moves the late read to the correct partition and ensures that data is stored in an optimized way.</p><h3 id="data-formats"> Data formats</h3><p>Table 1 shows inbound schema.</p><div class="table-wrapper"><table><thead><tr><th><strong>Field</strong><th><strong>Type</strong><th><strong>Format</strong><th><strong>Description</strong><tbody><tr><td>time<td>timestamp<td>yyyy-MM-dd HH:mm:ss.SSSSSSS<td>Timestamp when the meter read reaches the source system.<tr><td>arrival_time<td>timestamp<td>yyyy-MM-dd HH:mm:ss.SSSSSSS<td>Timestamp of the actual meter read.<tr><td>device_id<td>string<td>7a044be7-2f1e-3bf1-aa86-b8b1b9064f19<td>uuid<tr><td>measure_name<td>string<td> <td> <tr><td>load<td>double<td>0.000<td>Load, unit: A<tr><td>crrnt<td>double<td>0.000<td>Current, unit: A<tr><td>pf<td>double<td>0.000<td>Power factor, between 0 and 1<tr><td>vkva<td>double<td>0.000<td>Volt ampere, unit: VA<tr><td>kw<td>double<td>0.000<td>Kilowatt, unit: kW<tr><td>vltg<td>double<td>0.000<td>Voltage, unit: V</table></div><p><em>Table 1. Inbound schema</em></p><h3 id="inbound-format"> Inbound format</h3><p>The inbound meter-data format is variable and can be adjusted. The following shows the sample inbound data format of the meter data generator.</p><h3 id="integrated-format"> Integrated format</h3><p>Data are stored in the format shown in Table 2 in the integration stage.</p><div class="table-wrapper"><table><thead><tr><th><strong>Field</strong><th><strong>Type</strong><th><strong>Format</strong><tbody><tr><td>meter_id<td>String<td> <tr><td>reading_value<td>Double<td>0.000<tr><td>reading_date_time<td>Timestamp<td>yyyy-MM-dd HH:mm:ss.SSS<tr><td>unit<td>String<td> <tr><td>obis_code<td>String<td> <tr><td>phase<td>String<td> <tr><td>reading_source<td>String<td> <tr><td>reading_type<td>String (Partitioned)<td>load, crrnt, pf, kva, kw, vltg<tr><td>year<td>String (Partitioned)<td> <tr><td>month<td>String (Partitioned)<td> <tr><td>day<td>String (Partitioned)<td> <tr><td>hour<td>String (Partitioned)<td> </table></div><p><em>Table 2. Integration schema</em></p><h2 id="troubleshooting"> <a href="#troubleshooting" class="anchor-heading" aria-labelledby="troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting</h2><p>For common troubleshooting issues, visit <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html" target="_blank">Troubleshooting CloudFormation</a>.</p><h2 id="customer-responsibility"> <a href="#customer-responsibility" class="anchor-heading" aria-labelledby="customer-responsibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Customer responsibility</h2><p>After you deploy a Guidance, confirm that your resources and services are updated and configured—including any required patches—to meet your security and other needs. For more information, refer to the <a href="https://aws.amazon.com/compliance/shared-responsibility-model/" target="_blank">Shared Responsibility Model</a>.</p><h2 id="feedback"> <a href="#feedback" class="anchor-heading" aria-labelledby="feedback"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Feedback</h2><p>To submit feature ideas and report bugs, use the <strong>Issues</strong> section of the <a href="https://github.com/aws-solutions-library-samples/guidance-for-meter-data-analytics-on-aws" target="_blank">GitHub repository</a> for this Guidance.</p><h2 id="notices"> <a href="#notices" class="anchor-heading" aria-labelledby="notices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Notices</h2><p>This document is provided for informational purposes only. It represents current AWS product offerings and practices as of the date of issue of this document, which are subject to change without notice. Customers are responsible for making their own independent assessment of the information in this document and any use of AWS products or services, each of which is provided "as is" without warranty of any kind, whether expressed or implied. This document does not create any warranties, representations, contractual commitments, conditions, or assurances from AWS, its affiliates, suppliers, or licensors. The responsibilities and liabilities of AWS to its customers are controlled by AWS agreements, and this document is not part of, nor does it modify, any agreement between AWS and its customers.</p><p>The software included with this paper is licensed under the Apache License, version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at <a href="https://aws.amazon.com/apache2.0/" target="_blank">https://aws.amazon.com/apache2.0/</a> or in the accompanying "license" file. This code is distributed on an"as is" basis, without warranties or conditions of any kind, either expressed or implied. Refer to the License for specific language governing permissions and limitations.</p><p><a href="https://aws.amazon.com/privacy/" target="_blank">Privacy</a>| <a href="https://aws.amazon.com/terms/" target="_blank">Site terms</a>| © 2023, Amazon Web Services, Inc. or its affiliates and Amazon Web Services. All rights reserved.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p></footer></div></div><div class="search-overlay"></div></div>
